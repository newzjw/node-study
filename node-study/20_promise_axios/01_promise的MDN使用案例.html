<!--
 * @Author: your name
 * @Date: 2021-07-09 09:21:46
 * @LastEditTime: 2021-07-09 10:15:05
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \node-study\20_promise_axios\01_promise的MDN使用案例.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <!-- 
  Promise是什么?
  1.抽象表达: 
      1) Promise是一门新的技术(ES6规范)
      2) Promise是JS中进行异步编程的新解决方案(旧的是谁?)
  2.具体表达:
      1) 从语法上来说: Promise是一个构造函数
      2) 从功能上来说: promise对象用来封装一个异步操作并可以获取其成功/失败的结果值
  -->

  <script>
    const promise1 = new Promise((resolve, reject) => { // Promise的参数是一个excutor/执行器函数, 同步回调函数
      console.log('excutor()')
      // 开始时promise的状态为pending 未确定的/初始的
      // 启动异步任务
      setTimeout(() => {
        // 成功了
        resolve('foo') // promise对象的状态变为resolved/成功, 同时指定成功的value
      }, 2000)
    })

    console.log('new Promise()之后')

    promise1.then((value) => { // 异步执行的成功的回调函数，这里省略了失败时的回调
      console.log(value) // foo
    })
    console.log(promise1)
    // 执行的先后顺序
    // excutor()
    // new Promise()之后
    // Promise {<pending>}
    // foo

  </script>
  <script>
    /* 使用Promise封装异步ajax请求 */
    function myAsyncFunction(url) {
      // 返回一个promise实例对象
      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", url);
        xhr.onload = () => resolve(JSON.parse(xhr.responseText));  // 成功的回调
        xhr.onerror = () => reject(xhr.statusText); // 出错的回调
        xhr.send();
      })
    }

    myAsyncFunction('https://api.apiopen.top/getJoke?page=1&count=2&type=video')
      .then(
        value => {
          console.log('成功了', value) // value对应JSON.parse(xhr.responseText)
        },
        reason => {
          console.log('失败了', reason) // reason对应xhr.statusText
        }
      )
  </script>
</body>

</html>